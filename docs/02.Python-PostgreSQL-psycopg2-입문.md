# Python으로 PostgreSQL 다루기 (psycopg2)

이 가이드는 Python에서 PostgreSQL 데이터베이스를 다루는 방법을 **처음부터 끝까지** 단계별로 설명합니다.

> 📌 **관련 노트**: [PostgreSQL-초보자-강좌](01.PostgreSQL-초보자-강좌.md)

---

## 목차

1. [Step 1 사전 준비 확인](#step-1-사전-준비-확인)
2. [Step 2 프로젝트 환경 설정 venv](#step-2-프로젝트-환경-설정-venv)
3. [Step 3 연습용 데이터베이스 만들기](#step-3-연습용-데이터베이스-만들기)
4. [Step 4 Python에서 PostgreSQL 연결하기](#step-4-python에서-postgresql-연결하기)
5. [Step 5 테이블 생성하기](#step-5-테이블-생성하기)
6. [Step 6 데이터 삽입하기 INSERT](#step-6-데이터-삽입하기-insert)
7. [Step 7 데이터 조회하기 SELECT](#step-7-데이터-조회하기-select)
8. [Step 8 데이터 수정하기 UPDATE](#step-8-데이터-수정하기-update)
9. [Step 9 데이터 삭제하기 DELETE](#step-9-데이터-삭제하기-delete)
10. [Step 10 안전하게 연결 종료하기](#step-10-안전하게-연결-종료하기)
11. [Step 11 전체 예제 코드](#step-11-전체-예제-코드)
12. [자주 발생하는 오류와 해결법](#자주-발생하는-오류와-해결법)

---

## Step 1 사전 준비 확인

시작하기 전에 다음이 설치되어 있어야 합니다.

### Python 설치 확인

터미널(또는 명령 프롬프트)을 열고 입력:

```bash
python --version
```

결과 예시:

```
Python 3.12.0
```

> ⚠️ Python 3.6 이상이 필요합니다. 설치가 안 되어 있다면 [python.org](https://www.python.org/downloads/)에서 다운로드하세요.

### PostgreSQL 설치 확인

```bash
psql --version
```

결과 예시:

```
psql (PostgreSQL) 18.0
```

> ⚠️ PostgreSQL이 설치되어 있지 않다면 [PostgreSQL-초보자-강좌 - 2. 설치하기](01.PostgreSQL-초보자-강좌.md#2-설치하기)를 참고하세요.

---

## Step 2 프로젝트 환경 설정 venv

Python 프로젝트는 **가상환경(venv)**을 사용하는 것이 좋습니다. 프로젝트마다 독립된 패키지 환경을 유지할 수 있습니다.

### 2-1. 프로젝트 폴더 생성

명령 프롬프트(cmd)를 열고 다음을 입력합니다:

```cmd
mkdir C:\big20\python_postgres_tutorial
cd C:\big20\python_postgres_tutorial
```

> 💡 원하는 다른 경로를 사용해도 됩니다.

### 2-2. 가상환경 생성

```cmd
python -m venv venv # 기본 예시 실습은 다음에 나오는것으로 함
```

이 명령어는 `venv`라는 폴더를 생성합니다. 이 폴더 안에 독립된 Python 환경이 만들어집니다.

**특정 Python 버전으로 가상환경 만들기:**

여러 Python 버전이 설치되어 있다면, 원하는 버전을 지정할 수 있습니다:

```cmd
cd C:\big20\python_postgres_tutorial

# Python 3.12 설치
py install 3.12

# Python 3.12로 가상환경 생성
py -3.12 -m venv venv
```

> 💡 Windows에서는 `py` 런처를 사용하면 버전 지정이 편리합니다.

### 2-3. 가상환경 활성화

```cmd
venv\Scripts\activate

python --version
```

활성화되면 프롬프트 앞에 `(venv)`가 표시됩니다:

```
(venv) C:\big20\python_postgres_tutorial>
```

> 💡 **팁**: 작업이 끝나면 `deactivate` 명령어로 가상환경을 비활성화할 수 있습니다.

### 2-4. psycopg2 설치

가상환경이 활성화된 상태에서 설치합니다:

```bash
pip install psycopg2-binary
```

> 💡 `psycopg2-binary`는 미리 컴파일된 버전으로, 설치가 간편합니다.

### 2-5. 설치 확인

```bash
python -c "import psycopg2; print(psycopg2.__version__)"
```

결과 예시:

```
2.9.11 (dt dec pq3 ext lo64)
```

### 2-6. requirements.txt 생성 (선택사항)

나중에 환경을 재현할 수 있도록 패키지 목록을 저장합니다:

```bash
pip freeze > requirements.txt
```

> 💡 다른 환경에서 `pip install -r requirements.txt`로 동일한 패키지를 설치할 수 있습니다.

### 프로젝트 폴더 구조

이 시점에서 폴더 구조는 다음과 같습니다:

```
C:\big20\python_postgres_tutorial\
├── venv\                 # 가상환경 (Git에 포함하지 않음)
└── requirements.txt      # 패키지 목록
```

> ⚠️ **중요**: 앞으로 모든 Python 코드는 가상환경이 활성화된 상태에서 실행해야 합니다. 터미널에 `(venv)`가 보이는지 항상 확인하세요!

---

## Step 3 연습용 데이터베이스 만들기

Python 코드를 실행하기 전에, 연습용 데이터베이스를 먼저 만듭니다.

### 3-1. PostgreSQL에 접속

```bash
psql -U postgres
```

> 💡 비밀번호를 물어보면 설치 시 설정한 비밀번호를 입력하세요.

### 3-2. 데이터베이스 생성

```sql
CREATE DATABASE python_test;
```

결과:

```
CREATE DATABASE
```

### 3-3. 데이터베이스 확인

```sql
\l
```

목록에 `python_test`가 보이면 성공입니다.

### 3-4. psql 종료

```sql
\q
```

---

## Step 4 Python에서 PostgreSQL 연결하기

이제 Python 코드를 작성할 차례입니다.

### 4-1. 가상환경 활성화 확인

먼저 가상환경이 활성화되어 있는지 확인합니다:

```cmd
cd C:\big20\python_postgres_tutorial

# 가상환경 활성화 (아직 안 했다면)
venv\Scripts\activate
```

프롬프트에 `(venv)`가 보여야 합니다:

```
(venv) C:\big20\python_postgres_tutorial>
```

### 4-2. 첫 번째 Python 파일 작성

`01_connect.py` 파일을 만들고 다음 코드를 작성합니다:

```python
import psycopg2

# 데이터베이스 연결 정보
connection = psycopg2.connect(
    host="localhost",      # PostgreSQL 서버 주소
    port="5432",           # 포트 (기본값: 5432)
    database="python_test", # 데이터베이스 이름
    user="postgres",       # 사용자 이름
    password="your_password"  # 비밀번호 (본인 것으로 변경!)
)

print("PostgreSQL 연결 성공!")

# 연결 정보 확인
print(f"서버 버전: {connection.server_version}")

# 연결 종료
connection.close()
print("연결 종료")
```

### 4-3. 실행하기

```bash
python 01_connect.py
```

결과:

```
PostgreSQL 연결 성공!
서버 버전: 180000
연결 종료
```

> ⚠️ **오류가 발생하면** [자주 발생하는 오류와 해결법](#자주-발생하는-오류와-해결법) 섹션을 확인하세요.

---

## Step 5 테이블 생성하기

연결에 성공했으니, 이제 테이블을 만들어봅니다.

### 5-1. 새 파일 작성

`02_create_table.py` 파일을 만듭니다:

```python
import psycopg2

# 연결
connection = psycopg2.connect(
    host="localhost",
    database="python_test",
    user="postgres",
    password="your_password"
)

# 커서 생성 (SQL 실행을 위한 객체)
cursor = connection.cursor()

# 테이블 생성 SQL
create_table_query = """
CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE,
    age INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
"""

# SQL 실행
cursor.execute(create_table_query)

# 변경사항 저장 (커밋)
connection.commit()

print("테이블 생성 완료!")

# 정리
cursor.close()
connection.close()
```

### 5-2. 실행

```bash
python 02_create_table.py
```

결과:

```
테이블 생성 완료!
```

### 5-3. 테이블 확인 (선택사항)

psql에서 확인해볼 수 있습니다:

```bash
psql -U postgres -d python_test -c "\d users"
```

---

## Step 6 데이터 삽입하기 INSERT

테이블에 데이터를 넣어봅니다.

### 6-1. 새 파일 작성

`03_insert.py` 파일을 만듭니다:

```python
import psycopg2

connection = psycopg2.connect(
    host="localhost",
    database="python_test",
    user="postgres",
    password="your_password"
)

cursor = connection.cursor()

# ========================================
# 방법 1: 단일 데이터 삽입
# ========================================
insert_query = """
INSERT INTO users (name, email, age)
VALUES (%s, %s, %s);
"""

# %s 자리에 들어갈 값들 (튜플로 전달)
data = ("홍길동", "hong@example.com", 25)

cursor.execute(insert_query, data)
print("홍길동 추가 완료")

# ========================================
# 방법 2: 여러 데이터 한 번에 삽입
# ========================================
users_data = [
    ("김철수", "kim@example.com", 30),
    ("이영희", "lee@example.com", 28),
    ("박민수", "park@example.com", 35),
]

cursor.executemany(insert_query, users_data)
print(f"{len(users_data)}명 추가 완료")

# 커밋 (중요! 이걸 해야 실제로 저장됨)
connection.commit()

print("모든 데이터 삽입 완료!")

cursor.close()
connection.close()
```

> ⚠️ **중요**: `%s`는 플레이스홀더입니다. 직접 문자열을 넣으면 **SQL 인젝션** 공격에 취약해집니다. 항상 `%s`와 튜플을 사용하세요!

### 6-2. 실행

```bash
python 03_insert.py
```

결과:

```
홍길동 추가 완료
3명 추가 완료
모든 데이터 삽입 완료!
```

---

## Step 7 데이터 조회하기 SELECT

저장된 데이터를 읽어옵니다.

### 7-1. 새 파일 작성

`04_select.py` 파일을 만듭니다:

```python
import psycopg2

connection = psycopg2.connect(
    host="localhost",
    database="python_test",
    user="postgres",
    password="your_password"
)

cursor = connection.cursor()

# ========================================
# 방법 1: 모든 데이터 조회
# ========================================
print("=" * 50)
print("모든 사용자 조회")
print("=" * 50)

cursor.execute("SELECT * FROM users;")

# 모든 결과 가져오기
rows = cursor.fetchall()

for row in rows:
    print(f"ID: {row[0]}, 이름: {row[1]}, 이메일: {row[2]}, 나이: {row[3]}")

# ========================================
# 방법 2: 조건으로 조회
# ========================================
print("\n" + "=" * 50)
print("25세 이상 사용자 조회")
print("=" * 50)

cursor.execute("SELECT name, age FROM users WHERE age >= %s;", (25,))

rows = cursor.fetchall()

for row in rows:
    print(f"이름: {row[0]}, 나이: {row[1]}")

# ========================================
# 방법 3: 한 줄만 조회
# ========================================
print("\n" + "=" * 50)
print("첫 번째 사용자만 조회")
print("=" * 50)

cursor.execute("SELECT * FROM users ORDER BY id LIMIT 1;")

# 한 줄만 가져오기
row = cursor.fetchone()

if row:
    print(f"ID: {row[0]}, 이름: {row[1]}")

cursor.close()
connection.close()
```

### 7-2. 실행

```bash
python 04_select.py
```

결과:

```
==================================================
모든 사용자 조회
==================================================
ID: 1, 이름: 홍길동, 이메일: hong@example.com, 나이: 25
ID: 2, 이름: 김철수, 이메일: kim@example.com, 나이: 30
ID: 3, 이름: 이영희, 이메일: lee@example.com, 나이: 28
ID: 4, 이름: 박민수, 이메일: park@example.com, 나이: 35

==================================================
25세 이상 사용자 조회
==================================================
이름: 홍길동, 나이: 25
이름: 김철수, 나이: 30
이름: 이영희, 나이: 28
이름: 박민수, 나이: 35

==================================================
첫 번째 사용자만 조회
==================================================
ID: 1, 이름: 홍길동
```

### fetch 메서드 정리

| 메서드         | 설명                        |
| -------------- | --------------------------- |
| `fetchone()`   | 결과에서 한 줄만 가져옴     |
| `fetchall()`   | 모든 결과를 리스트로 가져옴 |
| `fetchmany(n)` | n개의 결과를 가져옴         |

---

## Step 8 데이터 수정하기 UPDATE

기존 데이터를 수정합니다.

### 8-1. 새 파일 작성

`05_update.py` 파일을 만듭니다:

```python
import psycopg2

connection = psycopg2.connect(
    host="localhost",
    database="python_test",
    user="postgres",
    password="your_password"
)

cursor = connection.cursor()

# ========================================
# 수정 전 데이터 확인
# ========================================
print("수정 전:")
cursor.execute("SELECT * FROM users WHERE name = %s;", ("홍길동",))
row = cursor.fetchone()
print(f"  이름: {row[1]}, 나이: {row[3]}")

# ========================================
# 데이터 수정
# ========================================
update_query = """
UPDATE users
SET age = %s
WHERE name = %s;
"""

cursor.execute(update_query, (26, "홍길동"))

# 커밋 (중요!)
connection.commit()

# 수정된 행 수 확인
print(f"\n{cursor.rowcount}개 행이 수정되었습니다.")

# ========================================
# 수정 후 데이터 확인
# ========================================
print("\n수정 후:")
cursor.execute("SELECT * FROM users WHERE name = %s;", ("홍길동",))
row = cursor.fetchone()
print(f"  이름: {row[1]}, 나이: {row[3]}")

cursor.close()
connection.close()
```

### 8-2. 실행

```bash
python 05_update.py
```

결과:

```
수정 전:
  이름: 홍길동, 나이: 25

1개 행이 수정되었습니다.

수정 후:
  이름: 홍길동, 나이: 26
```

---

## Step 9 데이터 삭제하기 DELETE

데이터를 삭제합니다.

### 9-1. 새 파일 작성

`06_delete.py` 파일을 만듭니다:

```python
import psycopg2

connection = psycopg2.connect(
    host="localhost",
    database="python_test",
    user="postgres",
    password="your_password"
)

cursor = connection.cursor()

# ========================================
# 삭제 전 데이터 확인
# ========================================
print("삭제 전 전체 사용자:")
cursor.execute("SELECT id, name FROM users;")
for row in cursor.fetchall():
    print(f"  ID: {row[0]}, 이름: {row[1]}")

# ========================================
# 특정 데이터 삭제
# ========================================
delete_query = "DELETE FROM users WHERE name = %s;"
cursor.execute(delete_query, ("박민수",))

connection.commit()

print(f"\n{cursor.rowcount}개 행이 삭제되었습니다.")

# ========================================
# 삭제 후 데이터 확인
# ========================================
print("\n삭제 후 전체 사용자:")
cursor.execute("SELECT id, name FROM users;")
for row in cursor.fetchall():
    print(f"  ID: {row[0]}, 이름: {row[1]}")

cursor.close()
connection.close()
```

### 9-2. 실행

```bash
python 06_delete.py
```

결과:

```
삭제 전 전체 사용자:
  ID: 1, 이름: 홍길동
  ID: 2, 이름: 김철수
  ID: 3, 이름: 이영희
  ID: 4, 이름: 박민수

1개 행이 삭제되었습니다.

삭제 후 전체 사용자:
  ID: 1, 이름: 홍길동
  ID: 2, 이름: 김철수
  ID: 3, 이름: 이영희
```

---

## Step 10 안전하게 연결 종료하기

지금까지 `close()`를 직접 호출했지만, 오류가 발생하면 연결이 제대로 닫히지 않을 수 있습니다.

### with 문 사용하기 (권장)

`07_with_statement.py` 파일을 만듭니다:

```python
import psycopg2

# with 문을 사용하면 자동으로 정리됨
try:
    with psycopg2.connect(
        host="localhost",
        database="python_test",
        user="postgres",
        password="your_password"
    ) as connection:

        with connection.cursor() as cursor:
            cursor.execute("SELECT * FROM users;")
            rows = cursor.fetchall()

            print("사용자 목록:")
            for row in rows:
                print(f"  {row[1]} ({row[2]})")

        # with 블록을 벗어나면 자동으로 커밋됨

except psycopg2.Error as e:
    print(f"데이터베이스 오류: {e}")

print("\n연결이 자동으로 종료되었습니다.")
```

> 💡 `with` 문을 사용하면:
>
> - 오류가 발생해도 연결이 자동으로 닫힘
> - 정상 종료 시 자동으로 커밋됨
> - 오류 발생 시 자동으로 롤백됨

---

## Step 11 전체 예제 코드

모든 CRUD 작업을 하나의 파일에 정리한 완전한 예제입니다.

`complete_example.py` 파일을 만듭니다:

```python
"""
Python + PostgreSQL (psycopg2) 완전한 CRUD 예제
"""

import psycopg2
from psycopg2 import sql

# ============================================================
# 설정
# ============================================================
DB_CONFIG = {
    "host": "localhost",
    "port": "5432",
    "database": "python_test",
    "user": "postgres",
    "password": "your_password"  # 본인 비밀번호로 변경!
}


def get_connection():
    """데이터베이스 연결을 반환합니다."""
    return psycopg2.connect(**DB_CONFIG)


# ============================================================
# CREATE - 테이블 생성
# ============================================================
def create_table():
    """users 테이블을 생성합니다."""
    query = """
    CREATE TABLE IF NOT EXISTS users (
        id SERIAL PRIMARY KEY,
        name VARCHAR(100) NOT NULL,
        email VARCHAR(100) UNIQUE,
        age INTEGER,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
    """

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(query)

    print("[CREATE] 테이블 생성 완료")


# ============================================================
# CREATE - 데이터 삽입
# ============================================================
def insert_user(name, email, age):
    """새 사용자를 추가합니다."""
    query = """
    INSERT INTO users (name, email, age)
    VALUES (%s, %s, %s)
    RETURNING id;
    """

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(query, (name, email, age))
            new_id = cur.fetchone()[0]

    print(f"[INSERT] '{name}' 추가 완료 (ID: {new_id})")
    return new_id


def insert_many_users(users_list):
    """여러 사용자를 한 번에 추가합니다."""
    query = """
    INSERT INTO users (name, email, age)
    VALUES (%s, %s, %s);
    """

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.executemany(query, users_list)

    print(f"[INSERT] {len(users_list)}명 추가 완료")


# ============================================================
# READ - 데이터 조회
# ============================================================
def get_all_users():
    """모든 사용자를 조회합니다."""
    query = "SELECT id, name, email, age FROM users ORDER BY id;"

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(query)
            users = cur.fetchall()

    print("\n[SELECT] 전체 사용자 목록:")
    print("-" * 60)
    for user in users:
        print(f"  ID: {user[0]}, 이름: {user[1]}, 이메일: {user[2]}, 나이: {user[3]}")
    print("-" * 60)

    return users


def get_user_by_id(user_id):
    """ID로 사용자를 조회합니다."""
    query = "SELECT id, name, email, age FROM users WHERE id = %s;"

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(query, (user_id,))
            user = cur.fetchone()

    if user:
        print(f"[SELECT] 사용자 찾음: {user[1]} ({user[2]})")
    else:
        print(f"[SELECT] ID {user_id} 사용자를 찾을 수 없습니다.")

    return user


def search_users_by_age(min_age):
    """특정 나이 이상의 사용자를 조회합니다."""
    query = "SELECT id, name, age FROM users WHERE age >= %s ORDER BY age;"

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(query, (min_age,))
            users = cur.fetchall()

    print(f"\n[SELECT] {min_age}세 이상 사용자:")
    for user in users:
        print(f"  {user[1]} - {user[2]}세")

    return users


# ============================================================
# UPDATE - 데이터 수정
# ============================================================
def update_user_age(user_id, new_age):
    """사용자의 나이를 수정합니다."""
    query = "UPDATE users SET age = %s WHERE id = %s;"

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(query, (new_age, user_id))
            affected = cur.rowcount

    if affected:
        print(f"[UPDATE] ID {user_id} 사용자의 나이를 {new_age}세로 수정")
    else:
        print(f"[UPDATE] ID {user_id} 사용자를 찾을 수 없습니다.")

    return affected


def update_user_email(user_id, new_email):
    """사용자의 이메일을 수정합니다."""
    query = "UPDATE users SET email = %s WHERE id = %s;"

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(query, (new_email, user_id))
            affected = cur.rowcount

    if affected:
        print(f"[UPDATE] ID {user_id} 사용자의 이메일을 '{new_email}'로 수정")

    return affected


# ============================================================
# DELETE - 데이터 삭제
# ============================================================
def delete_user(user_id):
    """사용자를 삭제합니다."""
    query = "DELETE FROM users WHERE id = %s;"

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(query, (user_id,))
            affected = cur.rowcount

    if affected:
        print(f"[DELETE] ID {user_id} 사용자 삭제 완료")
    else:
        print(f"[DELETE] ID {user_id} 사용자를 찾을 수 없습니다.")

    return affected


def delete_all_users():
    """모든 사용자를 삭제합니다. (주의!)"""
    query = "TRUNCATE TABLE users RESTART IDENTITY;"

    with get_connection() as conn:
        with conn.cursor() as cur:
            cur.execute(query)

    print("[DELETE] 모든 사용자 삭제 완료")


# ============================================================
# 메인 실행
# ============================================================
if __name__ == "__main__":
    print("=" * 60)
    print("Python + PostgreSQL CRUD 예제")
    print("=" * 60)

    # 1. 테이블 생성
    create_table()

    # 2. 기존 데이터 삭제 (깨끗한 시작)
    delete_all_users()

    # 3. 데이터 삽입
    print("\n--- 데이터 삽입 ---")
    insert_user("홍길동", "hong@example.com", 25)
    insert_user("김철수", "kim@example.com", 30)

    insert_many_users([
        ("이영희", "lee@example.com", 28),
        ("박민수", "park@example.com", 35),
        ("최수진", "choi@example.com", 22),
    ])

    # 4. 데이터 조회
    print("\n--- 데이터 조회 ---")
    get_all_users()

    get_user_by_id(1)
    get_user_by_id(999)  # 존재하지 않는 ID

    search_users_by_age(28)

    # 5. 데이터 수정
    print("\n--- 데이터 수정 ---")
    update_user_age(1, 26)
    update_user_email(2, "kim.new@example.com")

    # 수정 결과 확인
    get_all_users()

    # 6. 데이터 삭제
    print("\n--- 데이터 삭제 ---")
    delete_user(5)  # 최수진 삭제

    # 삭제 결과 확인
    get_all_users()

    print("\n" + "=" * 60)
    print("모든 작업 완료!")
    print("=" * 60)
```

### 실행 결과

```bash
python complete_example.py
```

```
============================================================
Python + PostgreSQL CRUD 예제
============================================================
[CREATE] 테이블 생성 완료
[DELETE] 모든 사용자 삭제 완료

--- 데이터 삽입 ---
[INSERT] '홍길동' 추가 완료 (ID: 1)
[INSERT] '김철수' 추가 완료 (ID: 2)
[INSERT] 3명 추가 완료

--- 데이터 조회 ---

[SELECT] 전체 사용자 목록:
------------------------------------------------------------
  ID: 1, 이름: 홍길동, 이메일: hong@example.com, 나이: 25
  ID: 2, 이름: 김철수, 이메일: kim@example.com, 나이: 30
  ID: 3, 이름: 이영희, 이메일: lee@example.com, 나이: 28
  ID: 4, 이름: 박민수, 이메일: park@example.com, 나이: 35
  ID: 5, 이름: 최수진, 이메일: choi@example.com, 나이: 22
------------------------------------------------------------
[SELECT] 사용자 찾음: 홍길동 (hong@example.com)
[SELECT] ID 999 사용자를 찾을 수 없습니다.

[SELECT] 28세 이상 사용자:
  이영희 - 28세
  김철수 - 30세
  박민수 - 35세

--- 데이터 수정 ---
[UPDATE] ID 1 사용자의 나이를 26세로 수정
[UPDATE] ID 2 사용자의 이메일을 'kim.new@example.com'로 수정

[SELECT] 전체 사용자 목록:
------------------------------------------------------------
  ID: 1, 이름: 홍길동, 이메일: hong@example.com, 나이: 26
  ID: 2, 이름: 김철수, 이메일: kim.new@example.com, 나이: 30
  ID: 3, 이름: 이영희, 이메일: lee@example.com, 나이: 28
  ID: 4, 이름: 박민수, 이메일: park@example.com, 나이: 35
  ID: 5, 이름: 최수진, 이메일: choi@example.com, 나이: 22
------------------------------------------------------------

--- 데이터 삭제 ---
[DELETE] ID 5 사용자 삭제 완료

[SELECT] 전체 사용자 목록:
------------------------------------------------------------
  ID: 1, 이름: 홍길동, 이메일: hong@example.com, 나이: 26
  ID: 2, 이름: 김철수, 이메일: kim.new@example.com, 나이: 30
  ID: 3, 이름: 이영희, 이메일: lee@example.com, 나이: 28
  ID: 4, 이름: 박민수, 이메일: park@example.com, 나이: 35
------------------------------------------------------------

============================================================
모든 작업 완료!
============================================================
```

---

## 자주 발생하는 오류와 해결법

### 오류 1: Connection refused

```
psycopg2.OperationalError: connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused
```

**원인**: PostgreSQL 서비스가 실행되지 않음

**해결**:

1. `Win + R` → `services.msc` 입력
2. `postgresql` 서비스 찾기
3. 우클릭 → "시작" 클릭

### 오류 2: Password authentication failed

```
psycopg2.OperationalError: password authentication failed for user "postgres"
```

**원인**: 비밀번호가 틀림

**해결**: 코드의 `password` 값을 확인하세요.

### 오류 3: Database does not exist

```
psycopg2.OperationalError: FATAL: database "python_test" does not exist
```

**원인**: 데이터베이스를 아직 생성하지 않음

**해결**: [Step 3 연습용 데이터베이스 만들기](#step-3-연습용-데이터베이스-만들기) 참고

### 오류 4: Module not found

```
ModuleNotFoundError: No module named 'psycopg2'
```

**원인**: psycopg2가 설치되지 않음

**해결**:

```bash
pip install psycopg2-binary
```

### 오류 5: Duplicate key value

```
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "users_email_key"
```

**원인**: 이미 같은 이메일이 존재함 (UNIQUE 제약 조건 위반)

**해결**: 다른 이메일을 사용하거나, 기존 데이터를 삭제하세요.

---

## 다음 단계

이 기초를 익힌 후 학습할 주제:

- [ ] 트랜잭션 처리 (ROLLBACK, SAVEPOINT)
- [ ] 커넥션 풀링 (psycopg2.pool)
- [ ] 비동기 처리 (asyncpg)
- [ ] ORM 사용 (SQLAlchemy)
- [ ] Flask/FastAPI와 연동

---

## 핵심 요약

| 작업     | 메서드/함수                      | 설명               |
| -------- | -------------------------------- | ------------------ |
| 연결     | `psycopg2.connect()`             | DB 연결 생성       |
| 커서     | `connection.cursor()`            | SQL 실행 객체 생성 |
| 실행     | `cursor.execute(query, params)`  | SQL 실행           |
| 다중실행 | `cursor.executemany()`           | 여러 데이터 한번에 |
| 조회     | `cursor.fetchone/all/many()`     | 결과 가져오기      |
| 저장     | `connection.commit()`            | 변경사항 저장      |
| 취소     | `connection.rollback()`          | 변경사항 취소      |
| 종료     | `cursor.close()`, `conn.close()` | 리소스 정리        |

> 💡 **가장 중요한 것**: INSERT, UPDATE, DELETE 후에는 반드시 `commit()`을 호출하세요!
