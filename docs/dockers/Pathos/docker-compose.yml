version: '3.8'

services:
  # 1. 정밀 분석 워커 (기존)
  analysis_worker:
    build: .
    container_name: worker_analysis
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    env_file: .env
    command: celery -A tasks worker -Q analysis_queue --concurrency=1 --loglevel=info

  # 2. 배치 스케줄러 (기존)
  celery_beat:
    build: .
    container_name: interview_beat
    env_file: .env
    command: celery -A tasks beat --loglevel=info

  # 3. 배치 전용 워커 (기존)
  batch_worker:
    build: .
    container_name: worker_batch
    env_file: .env
    command: celery -A tasks worker -Q batch_queue --loglevel=info

  # 4. [신규] TTS 엔진 (Coqui TTS 활용)
  tts_service:
    image: ghcr.io/coqui-ai/tts-gpu:latest
    container_name: tts_server
    ports:
      - "5002:5002"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    environment:
      - TTS_MODEL=tts_models/ko/krn/multi-vits # 한국어 멀티 보이스 모델 추천
    restart: always