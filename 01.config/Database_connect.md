## 1. DBeaver 연결 설정 값

DBeaver에서 **새 연결(New Connection)**을 누르고 **Oracle**을 선택한 뒤, 다음 항목들을 입력하세요.

| **항목**            | **입력 값** | **비고**                      |
| ------------------------- | ----------------- | ----------------------------------- |
| **Connection Type** | **Basic**   | 기본 설정                           |
| **Host**            | 192.68.40.54      |                                     |
| **Port**            | `1521`          |                                     |
| **Database (SID)**  | `XE`            | `gvenzl/oracle-xe`이미지의 기본값 |
| **Username**        | `SYSTEM`        | 또는 `.env`에 설정한 계정         |
| **Password**        | oracle_pass       | `ORACLE_PASSWORD`값               |


## 2. 오라클 DB 작업

```
관계형 데이터베이스 (Oracle) 는 데이터 무결성을 보장하기 위해 사용됩니다 .

● **Users (** 사용자 **):** id, email, role (candidate/recruiter), password_hash, created_at.
● **Interviews (** 면접 세션 **):** id, candidate_id, job_posting_id, status(scheduled/live/completed), start_time, end_time, overall_score.
● **Questions (** 질문 은행 **):** id, content, category, difficulty, rubric_json ( 평가 기준 ), vector_id
(Vector DB 참조 ).
● **Transcripts (** 대화 기록 **):** id, interview_id, speaker (AI/User), text, timestamp, sentiment_score.
● **Evaluation_Reports (** 평가 리포트 **):** id, interview_id, technical_score, communication_score, cultural_fit_score, summary_text, details_json.
```


식별된 RFP 요구사항을 바탕으로 Docker 환경의 Oracle XE에서 실제 서비스를 운영할 수 있는 수준까지의 설정 과정을 **Step-by-Step**으로 정리해 드립니다.

이미 Docker 컨테이너가 실행 중이라는 가정하에, DBeaver를 사용하거나 `docker exec`를 통해 작업하시면 됩니다.

---

### Step 1. 관리자(SYSTEM) 계정으로 접속 및 전용 사용자 생성

Oracle은 관리자 계정(SYSTEM)으로 직접 데이터를 넣기보다, 서비스 전용 사용자(Schema)를 만들어 사용하는 것이 표준입니다.

1. **DBeaver**에서 위에서 설정한 `SYSTEM` 계정으로 접속합니다.
2. **SQL Editor**를 열고 아래 명령어를 실행하여 서비스를 위한 사용자를 생성합니다. (예: `my_service` 계정)

**SQL**

```
-- 1. 사용자 생성 (비밀번호는 원하는 것으로 변경하세요)
CREATE USER rhetorica IDENTIFIED BY your_password;

-- 2. 권한 부여 (접속 권한 및 테이블 생성 권한 등)
GRANT CONNECT, RESOURCE, UNLIMITED TABLESPACE TO my_service;
```

---

### Step 2. 생성한 사용자 계정으로 다시 접속

이제 `SYSTEM`이 아닌, 방금 만든 `my_service` 계정으로 DBeaver에서 **새로운 연결**을 만듭니다. 이후 모든 테이블 생성 작업은 이 계정에서 진행합니다.

---

### Step 3. 테이블 생성 (ERD 기반)

RFP에 명시된 5개의 테이블을 생성합니다. Oracle XE 버전에 맞춘 최적의 데이터 타입을 적용했습니다.

**SQL**

```
-- 1. Users 테이블
CREATE TABLE Users (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email VARCHAR2(255) UNIQUE NOT NULL,
    role VARCHAR2(20) CHECK (role IN ('candidate', 'recruiter')) NOT NULL,
    password_hash VARCHAR2(500) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. Interviews 테이블
CREATE TABLE Interviews (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    candidate_id NUMBER NOT NULL,
    job_posting_id NUMBER NOT NULL,
    status VARCHAR2(20) CHECK (status IN ('scheduled', 'live', 'completed')),
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    overall_score NUMBER(5, 2),
    CONSTRAINT fk_user_interview FOREIGN KEY (candidate_id) REFERENCES Users(id)
);

-- 3. Questions 테이블
CREATE TABLE Questions (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    content CLOB NOT NULL, -- 질문 내용은 길 수 있으므로 CLOB 사용
    category VARCHAR2(100),
    difficulty VARCHAR2(20),
    rubric_json CLOB, -- JSON 데이터 저장 (Oracle 12c 이상 지원)
    vector_id VARCHAR2(100) -- Vector DB 연동용 ID
);

-- 4. Transcripts 테이블
CREATE TABLE Transcripts (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    interview_id NUMBER NOT NULL,
    speaker VARCHAR2(10) CHECK (speaker IN ('AI', 'User')),
    text CLOB,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    sentiment_score NUMBER(3, 2),
    CONSTRAINT fk_interview_transcript FOREIGN KEY (interview_id) REFERENCES Interviews(id)
);

-- 5. Evaluation_Reports 테이블
CREATE TABLE Evaluation_Reports (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    interview_id NUMBER UNIQUE NOT NULL, -- 1대1 관계 유지를 위해 UNIQUE 추가
    technical_score NUMBER(5, 2),
    communication_score NUMBER(5, 2),
    cultural_fit_score NUMBER(5, 2),
    summary_text CLOB,
    details_json CLOB,
    CONSTRAINT fk_interview_eval FOREIGN KEY (interview_id) REFERENCES Interviews(id)
);
```

---

### Step 4. 데이터 무결성 보장을 위한 추가 작업

RFP에서 **"데이터 무결성 보장"**을 강조했으므로, 아래 작업을 추가하는 것이 좋습니다.

1. **인덱스(Index) 생성:** 조회 성능을 위해 자주 검색되는 컬럼에 인덱스를 생성합니다.
   **SQL**

   ```
   CREATE INDEX idx_users_email ON Users(email);
   CREATE INDEX idx_interviews_candidate ON Interviews(candidate_id);
   ```
2. **JSON 제약 조건 (선택 사항):** `rubric_json`이나 `details_json` 컬럼에 올바른 JSON 형식이 들어오는지 검증 로직을 넣을 수 있습니다. (Oracle 12c 이상)
   **SQL**

   ```
   ALTER TABLE Questions ADD CONSTRAINT ensure_json_rubric CHECK (rubric_json IS JSON);
   ```

---

### Step 5. 작업 확인

DBeaver의 왼쪽 **Database Navigator**에서 생성된 테이블 목록을 확인하고, `SELECT * FROM 테이블명;`을 실행하여 정상적으로 생성되었는지 확인하면 모든 준비가 끝납니다.

**정리하자면:**

1. 관리자로 접속 -> 2. 서비스 계정 생성 -> 3. 서비스 계정으로 재접속 -> 4. DDL(테이블 생성) 실행 순으로 진행하시면 됩니다!
