# 파일서버구성.md

## 목표
- 3대의 로컬 PC(a, b, c)에서 Docker 컨테이너를 이용해 모의면접 시스템을 구성
- **b 서버**에 이력서 업로드용 공유 디렉터리를 두고, a·c 서버가 해당 디렉터리에 접근하도록 함

---

## 전체 아키텍처 (예시)
```
+-------------------+          +-------------------+          +-------------------+
|  PC‑a (Docker)   |          |  PC‑b (Docker)   |          |  PC‑c (Docker)   |
|  app‑a            |  <---NFS--->  resume‑share (NFS export)   |  app‑c            |
|  (frontend)      |          |  app‑b (backend) |          |  (frontend)      |
+-------------------+          +-------------------+          +-------------------+
```
- **PC‑b**: `/srv/resume` 디렉터리를 NFS 서버로 export
- **PC‑a**, **PC‑c**: NFS 클라이언트로 마운트하고 Docker‑Compose에서 볼륨으로 선언

---

## 1️⃣ PC‑b (파일‑서버) 설정
### 1‑1. Linux (Ubuntu) 기준 NFS 서버 설치
```bash
sudo apt-get update
sudo apt-get install -y nfs-kernel-server

# 공유 디렉터리 생성
sudo mkdir -p /srv/resume
sudo chown nobody:nogroup /srv/resume
sudo chmod 777 /srv/resume   # 테스트용, 실제 운영 시 권한 조정 필요

# /etc/exports 에 내보내기 설정 추가
echo "/srv/resume *(rw,sync,no_subtree_check)" | sudo tee -a /etc/exports

# NFS 서비스 재시작
sudo exportfs -ra
sudo systemctl restart nfs-kernel-server
```
> **보안**: 사설 네트워크(VPN) 안에서만 사용하거나 `stunnel/sshfs` 로 터널링 권장.

### 1‑2. Windows (WSL2) 혹은 SMB 사용 시
- Windows 기능 → **NFS 서비스** 활성화 후 `\b-pc\resume-share` 공유 폴더 생성
- 방화벽에서 **포트 2049**(TCP/UDP) 허용

### 1‑3. (선택) Docker‑Compose 로 MinIO 파일‑서버 실행
```yaml
version: "3.9"
services:
  minio:
    image: minio/minio:latest
    command: server /data
    environment:
      MINIO_ROOT_USER: admin
      MINIO_ROOT_PASSWORD: superSecret123
    ports:
      - "9000:9000"
    volumes:
      - resume-data:/data
volumes:
  resume-data:
    driver: local
    driver_opts:
      type: none
      device: /srv/resume   # 호스트 디스크 경로 바인드
      o: bind
```
- HTTP(S) API 로 파일 업로드/다운로드 가능 (추가 구현 필요).

---

## 2️⃣ PC‑a 와 PC‑c 에서 NFS 마운트 + Docker‑Compose
### 2‑1. NFS 클라이언트 설치 (Linux)
```bash
sudo apt-get install -y nfs-common
sudo mkdir -p /mnt/resume-share
# 영구 마운트 (필요 시 /etc/fstab 에 추가)
echo "b-pc:/srv/resume /mnt/resume-share nfs defaults 0 0" | sudo tee -a /etc/fstab
sudo mount -a
```
- Windows에서는 네트워크 드라이브 매핑 후 `docker run -v //b-pc/resume-share:/app/resume` 사용.

### 2‑2. Docker‑Compose (a 서버) 예시
```yaml
version: "3.9"
services:
  app-a:
    image: your-company/mock-interview-frontend:latest
    ports:
      - "8080:80"
    volumes:
      - /mnt/resume-share:/app/resume:rw
    environment:
      RESUME_UPLOAD_PATH: /app/resume
```
- **PC‑c**도 동일하게 `app-c` 서비스만 이름만 바꾸면 사용 가능.

### 2‑3. Docker‑Compose (b 서버) – 백엔드 (파일 업로드 API) 예시
```yaml
version: "3.9"
services:
  backend-b:
    image: your-company/mock-interview-backend:latest
    ports:
      - "5000:5000"
    volumes:
      - /srv/resume:/app/resume:rw
    environment:
      RESUME_DIR: /app/resume
```
- 백엔드가 `/app/resume` 에 저장하면 NFS를 통해 a·c 컨테이너에서도 실시간 접근 가능.

---

## 3️⃣ 파일 업로드 흐름
1. 사용자가 **a 서버**(프론트엔드)에서 이력서를 업로드 → 백엔드(b) API 호출
2. 백엔드가 파일을 `/app/resume`(NFS 마운트) 에 저장
3. NFS 덕분에 **a·c** 컨테이너가 같은 경로를 마운트하고 있어 즉시 파일을 읽고 미리보기/다운로드 가능

> **핵심**: 업로드 시 MIME 검증, 파일 크기 제한, 바이러스 스캔 등 보안 로직을 백엔드에 반드시 구현.

---

## 4️⃣ 보안·운영 체크리스트
| 항목 | 확인 방법 | 권고 설정 |
|------|-----------|-----------|
| 네트워크 접근 | `telnet b-pc 2049` (NFS) 혹은 `nc -zv b-pc 9000` (MinIO) | VPN 혹은 방화벽으로 제한 |
| 인증 | NFS는 IP‑기반, MinIO는 AccessKey/SecretKey | TLS(HTTPS)와 JWT 적용 |
| 파일 권한 | `ls -l /srv/resume` | `chmod 750` + `chown appuser:appgroup` |
| 백업 | `rsync -av /srv/resume /backup/resume-$(date +%F)` | 일일/주간 스냅샷 |
| 모니터링 | `nfsstat -s` 혹은 MinIO Dashboard | 알림 설정 (디스크 용량, I/O) |

---

## 5️⃣ 대안 옵션
| 상황 | 대안 | 간단 구현 |
|------|------|----------|
| 인터넷을 통해 연결 | S3 호환 스토리지 (MinIO, AWS S3) | 백엔드·프론트엔드가 S3 SDK 로 직접 업로드 |
| 쿠버네티스 환경 | PersistentVolume + NFS CSI | `PersistentVolumeClaim` 로 NFS 마운트 |
| 간단 파일 공유 | sshfs | `sshfs user@b-pc:/srv/resume /mnt/resume` |
| 고가용성·암호화 필요 | GlusterFS / CephFS | 복제·암호화 제공 (복잡하지만 안정) |

---

## 결론
- **b 서버**가 NFS export 혹은 MinIO 같은 파일‑서버를 제공하면 a·c 서버가 동일 디렉터리를 마운트해 **이력서 파일을 공유**할 수 있습니다.
- 가장 직관적인 방법은 **NFS** 기반 공유이며, 보안이 필요하면 VPN·TLS 를 추가합니다.
- 필요에 따라 **MinIO**(HTTP API) 로 전환하거나, 쿠버네티스 환경에서는 **CSI** 를 활용할 수 있습니다.

**다음 단계**: 어느 방법(NFS 설치, MinIO 컨테이너, 혹은 다른 대안)부터 진행하고 싶은지 알려 주세요. 그에 맞는 구체적인 명령어와 설정 파일을 바로 제공해 드리겠습니다.
